---
title: "[DB] Index"
excerpt: "" 

categories:
  - DB
tags:
  - [DB]

toc: true
toc_sticky: true
 
date: 2022-10-25
last_modified_at: 2022-10-25
---

# ğŸš€ Index
---
- IndexëŠ” DB ë¶„ì•¼ì— ìˆì–´ì„œ í…Œì´ë¸”ì— ëŒ€í•œ ë™ì‘ì˜ ì†ë„ë¥¼ ë†’ì—¬ì£¼ëŠ” ìë£Œêµ¬ì¡°
- IndexëŠ” í…Œì´ë¸” ë‚´ 1ê°œì˜ ì»¬ëŸ¼ or ì—¬ëŸ¬ê°œì˜ ì»¬ëŸ¼ì„ ì´ìš©í•˜ì—¬ ìƒì„±ë  ìˆ˜ ìˆë‹¤.
- í”íˆ ì±…ì˜ ëª©ì°¨ì— ë¹„ìœ 

## ğŸ“ SQL
```sql
CREATE INDEX USER_COMPANY_INDEX ON USER(COMPANY_ID);
#2ê°œ ì´ìƒì˜ ì»¬ëŸ¼ì„ ì‚¬ìš©í•´ì„œ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ë„ ìˆë‹¤.
```

DBì˜ íŠ¹ì • í…Œì´ë¸”ì—ì„œ ì›í•˜ëŠ” ë°ì´í„°ë“¤ì„ ì¡°íšŒí•  ë•Œ, ì¡°ê±´ì ˆì— ì‚¬ìš©í•˜ëŠ” ì»¬ëŸ¼ì˜ Indexê°€ ì—†ë‹¤ë©´, í…Œì´ë¸” ì „ì²´ë¥¼ íƒìƒ‰(Full Scan) í•œë‹¤. ë”°ë¼ì„œ, í…Œì´ë¸”ì— ë°ì´í„°ì˜ ì–‘ì´ ë§ì•„ì§ˆìˆ˜ë¡ ê²€ìƒ‰ì— ì†Œìš”ë˜ëŠ” ì‹œê°„ì´ ê¸¸ì–´ì§„ë‹¤.

USER í…Œì´ë¸”ì˜ COMPANY_ID ì»¬ëŸ¼ì— ëŒ€í•œ Indexê°€ ì¡´ì¬í•œë‹¤ë©´, í…Œì´ë¸” ì „ì²´ë¥¼ íƒìƒ‰í•˜ì§€ ì•Šê³  í•´ë‹¹ Indexë¥¼ ë°”íƒ•ìœ¼ë¡œ ì›í•˜ëŠ” ë°ì´í„°ì˜ ìœ„ì¹˜ë¥¼ ë¹ ë¥´ê²Œ ê²€ìƒ‰í•œë‹¤. IndexëŠ” í…Œì´ë¸”ì— ìˆëŠ” í•˜ë‚˜ ì´ìƒì˜ ì»¬ëŸ¼ìœ¼ë¡œ ìƒì„±ì´ ê°€ëŠ¥í•˜ë‹¤.

<br>
# ğŸš€ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
---

100ë§Œê±´ì˜ ë°ì´í„°ê°€ ì¡´ì¬í•  ë•Œ, ì›í•˜ëŠ” ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ëŠ”ë° ê±¸ë¦¬ëŠ” ì‹œê°„ì„ ì¸¡ì •í•˜ëŠ” í…ŒìŠ¤íŠ¸ ì˜ˆì œ

```java

//@Table(indexes = {@Index(name = "i_user", columnList = "name")})
@Entity
public class User {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(unique = true, nullable = false)
    private String name;

    public User(String name) {
        this.name = name;
    }
}
```

```java
@SpringBootTest(webEnvironment = WebEnvironment.NONE)
class IndexTest {

    @Autowired
    private UserRepository userRepository;

    @Test
    void index_test() {
        // given
        for (int i = 0; i < 1_000_000; i++) {
            String randomName = UUID.randomUUID().toString();
            User user = new User(randomName);
            userRepository.save(user);
        }
        userRepository.save(new User("tester"));
        StopWatch stopWatch = new StopWatch();

        // when
        stopWatch.start();
        userRepository.findByName("tester").get();
        stopWatch.stop();

        // then
        System.out.println(stopWatch.prettyPrint());
    }
}
```

â†’ í…ŒìŠ¤íŠ¸ í™˜ê²½ì— ë”°ë¼ `ê²€ìƒ‰ ì„±ëŠ¥ì´ 2ë°°~4ë°° ì°¨ì´`ê°€ ë‚œë‹¤.

- Index ì ìš© ì „: ì•½ 0.22
![Untitled](https://user-images.githubusercontent.com/85219306/201018246-ee338655-8b8d-4976-b8bb-382f8cb45154.png)

- Index ì ìš© í›„: ì•½ 0.12
![Untitled](https://user-images.githubusercontent.com/85219306/201018327-3ffea0d4-6343-44e3-bf4b-aa518f16ed32.png)

<br>
# ğŸš€ Index ìë£Œ êµ¬ì¡°
---
DB Indexì— ì í•©í•œ ìë£Œ êµ¬ì¡°ëŠ” í¬ê²Œ Hash Table, B-Tree, B+Tree ë“±ì´ ìˆë‹¤.

## ğŸ“ HashTable
- Hash Tableì€ Key-Valueë¡œ ì´ë£¨ì–´ì§„ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ”ë° íŠ¹í™”ëœ ìë£Œ êµ¬ì¡°
- Hash Table ê¸°ë°˜ì˜ DB IndexëŠ” íŠ¹ì • ì»¬ëŸ¼ì˜ ê°’ê³¼ ë°ì´í„°ì˜ ìœ„ì¹˜ë¥¼ Key-Valueë¡œ ì‚¬ìš©í•œë‹¤.
- Hash Tableì€ ë‚´ë¶€ì— ë²„ì¼“ì´ë¼ëŠ” ë°°ì—´ì´ ì¡´ì¬í•˜ê³ , Hash í•¨ìˆ˜ë¥¼ í†µí•´ Keyë¥¼ ê³ ìœ í•œ Hash ê°’ìœ¼ë¡œ ë³€í™˜ì‹œí‚¨ë‹¤.
    - ë³€í™˜í•œ Hash ê°’ì„ ë°°ì—´ì˜ ì¸ë±ìŠ¤ë¡œ ì‚¬ìš©í•´ í•´ë‹¹ ì¸ë±ìŠ¤ì— Valueë¥¼ ì €ì¥í•œë‹¤.
    â†’ í‰ê·  ì‹œê°„ ë³µì¡ë„: O(1)
    - Hash í•¨ìˆ˜ë¥¼ ì œëŒ€ë¡œ ì •ì˜í•˜ì§€ ì•Šìœ¼ë©´ Hash í•¨ìˆ˜ë¥¼ í†µí•´ ì‚°ì¶œí•œ Hash ê°’ì´ ì¤‘ë³µë˜ëŠ” Hash ì¶©ëŒì´ ë°œìƒí•œë‹¤.
    â†’ ë„ˆë¬´ ë§ì€ Hash ì¶©ëŒì´ ë°œìƒí–ˆì„ë•Œì˜ ì‹œê°„ ë³µì¡ë„: O(N)ì— ìˆ˜ë ´
- Hash í•¨ìˆ˜ëŠ” Keyê°€ ì¡°ê¸ˆì´ë¼ë„ ë‹¤ë¥´ë©´ ì™„ì „íˆ ë‹¤ë¥¸ Hash ê°’ì„ ìƒì„±í•œë‹¤.
    - Hash Tableì„ ì‚¬ìš©í•˜ëŠ” Indexì˜ ê²½ìš° WHERE ì¡°ê±´ì˜ ë“±í˜¸(=)ì—°ì‚°ì—ëŠ” íš¨ìœ¨ì´ ì¢‹ì§€ë§Œ,
    ë¶€ë“±í˜¸ ì—°ì‚°(>, <)ì€ ë¶€ì í•©í•˜ë‹¤.
    - Hash Tableì€ ë‚´ë¶€ ë°ì´í„°ë“¤ì´ ì •ë ¬ë˜ì–´ ìˆì§€ ì•Šì•„ íƒìƒ‰ì´ ë¹„íš¨ìœ¨ì ì´ë‹¤.

## ğŸ“ B-Tree
![Untitled](https://user-images.githubusercontent.com/85219306/201018538-59a584d6-039f-4d5f-9bb5-cde99b126c82.png)

![Untitled](https://user-images.githubusercontent.com/85219306/201018602-26a8dfb1-d7a4-419e-847f-ccafbd1664dd.png)

- B-Treeë€ ìì‹ ë…¸ë“œê°€ 2ê°œ ì´ìƒì¸ íŠ¸ë¦¬ë¥¼ ì˜ë¯¸í•œë‹¤.
    - ì´ì§„ê²€ìƒ‰ íŠ¸ë¦¬ì²˜ëŸ¼ ê° Keyì˜ ì™¼ìª½ ìì‹ì€ í•­ìƒ Keyë³´ë‹¤ ì‘ì€ ê°’ì„, ì˜¤ë¥¸ìª½ ìì‹ì€ í° ê°’ì„ ê°€ì§„ë‹¤.
- B-Tree ê¸°ë°˜ì˜ DB IndexëŠ” íŠ¹ì • ì»¬ëŸ¼ì˜ ê°’(Key)ì— í•´ë‹¹í•˜ëŠ” ë…¸ë“œì— ë°ì´í„°ì˜ ìœ„ì¹˜(Value)ë¥¼ ì €ì¥í•œë‹¤.
- B-Treeì˜ Key-Value ê°’ë“¤ì€ í•­ìƒ Keyë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬ì´ë‹¤.
    - ë¶€ë“±í˜¸ ì—°ì‚°(>, <)ì— ëŒ€í•´ Hash Tableë³´ë‹¤ íš¨ìœ¨ì ì¸ ë°ì´í„° íƒìƒ‰ì´ ê°€ëŠ¥í•˜ë‹¤.
- B-TreeëŠ” ê· í˜• íŠ¸ë¦¬(Balanced Tree)ë¡œì„œ,  ìµœìƒìœ„ ë£¨íŠ¸ ë…¸ë“œì—ì„œ ë¦¬í”„ ë…¸ë“œê¹Œì§€ì˜ ê±°ë¦¬ê°€ ëª¨ë‘ ë™ì¼í•˜ë‹¤.
    - í‰ê·  ì‹œê°„ ë³µì¡ë„: O(logN)
- ë‹¨ì 
    - Indexê°€ ì ìš©ëœ í…Œì´ë¸”ì— ë°ì´í„° ê°±ì‹ (INSERT, UPDATE, DELETE)ì´ ë°˜ë³µë˜ë‹¤ ë³´ë©´, íŠ¸ë¦¬ì˜ ê· í˜•ì´ ê¹¨ì§€ë©´ì„œ ì„±ëŠ¥ì´ ì•…í™”ëœë‹¤.
    - DB Index ì»¬ëŸ¼ì€ ë¶€ë“±í˜¸(>, <)ë¥¼ ì´ìš©í•œ ìˆœì°¨ ê²€ìƒ‰ ì—°ì‚°ì´ ìì£¼ ë°œìƒí•œë‹¤.
    B-Treeê°€ Hash Tableë³´ë‹¤ ì„±ëŠ¥ì´ ì¢‹ì§€ë§Œ, ìˆœì°¨ ê²€ìƒ‰ì˜ ê²½ìš° ì¤‘ìœ„ ìˆœíšŒë¥¼ í•˜ê¸° ë•Œë¬¸ì— íš¨ìœ¨ì´ ì¢‹ì§€ ì•Šë‹¤.
    
    â†’ ë”°ë¼ì„œ `MySQL ì—”ì§„ì¸ InnoDBëŠ” B-Treeë¥¼ í™•ì¥, ê°œì„ í•œ B+Treeë¥¼ Indexì˜ ìë£Œ êµ¬ì¡°ë¡œ ì‚¬ìš©í•œë‹¤.`
    

## ğŸ“ B+Tree
![Untitled](https://user-images.githubusercontent.com/85219306/201018814-17e53b6b-fb35-472b-99cc-f097f839c7dc.png)

- B+TreeëŠ” B-Treeë¥¼ í™•ì¥, ê°œì„ í•œ ìë£Œ êµ¬ì¡°ë¡œì„œ, ë§ë‹¨ì˜ ë¦¬í”„ ë…¸ë“œì—ë§Œ ë°ì´í„°ì˜ ìœ„ì¹˜(Value)ë¥¼ ê´€ë¦¬í•œë‹¤.
- ì¤‘ê°„ ë¸Œëœì¹˜ ë…¸ë“œì— Valueê°€ ì—†ì–´ì„œ B-Treeë³´ë‹¤ ë©”ëª¨ë¦¬ë¥¼ ëœ ì°¨ì§€í•˜ëŠ” ë§Œí¼, ë…¸ë“œì˜ ë©”ëª¨ë¦¬ì— ë” ë§ì€ Keyë¥¼ ì €ì¥í•  ìˆ˜ ìˆë‹¤.
- í•˜ë‚˜ì˜ ë…¸ë“œì— ë” ë§ì€ Keyë¥¼ ì €ì¥í•˜ëŠ” ë§Œí¼ íŠ¸ë¦¬ì˜ ë†’ì´ê°€ ë” ë‚®ì•„ì§„ë‹¤.
- ë§ë‹¨ì˜ ë¦¬í”„ ë…¸ë“œë“¤ë¼ë¦¬ëŠ” LinkedList êµ¬ì¡°ë¡œ ì„œë¡œë¥¼ ì°¸ì¡°í•œë‹¤.
    - ë¶€ë“±í˜¸(>, <)ë¥¼ ì´ìš©í•œ ìˆœì°¨ ê²€ìƒ‰ ì—°ì‚°ì„ í•˜ëŠ” ê²½ìš°, ë§ë‹¨ ë¦¬í”„ ë…¸ë“œë¥¼ ì €ì¥í•œ LinkedListë¥¼ í•œë²ˆë§Œ íƒìƒ‰í•˜ë©´ ë˜ì„œ ì†ë„ê°€ ë¹ ë¥´ë‹¤.

<br>
# ğŸš€ ê³ ë ¤ ì‚¬í•­
---
- IndexëŠ” í•­ìƒ ìµœì‹  ìƒíƒœë¡œ ì •ë ¬ë˜ê¸° ìœ„í•´, ë°ì´í„° ê°±ì‹ (INSERT, UPDATE, DELETE) ì‘ì—…ì— ëŒ€í•´ ì¶”ê°€ì ì¸ ì—°ì‚°ì´ ë°œìƒí•œë‹¤.
    - INSERT: ìƒˆë¡œìš´ ë°ì´í„°ì— ëŒ€í•œ ì¸ë±ìŠ¤ê°€ ì¶”ê°€ëœë‹¤.
    - DELETE: ì‚­ì œí•˜ëŠ” ë°ì´í„°ì˜ ì¸ë±ìŠ¤ë¥¼ ì œê±°í•œë‹¤.
    - UPDATE: ê¸°ì¡´ì˜ ì¸ë±ìŠ¤ë¥¼ ì œê±°í•˜ê³ , ê°±ì‹ ëœ ë°ì´í„°ì— ëŒ€í•´ ì¸ë±ìŠ¤ë¥¼ ì¶”ê°€í•œë‹¤.
- Index íŠ¸ë¦¬ ìë£Œ êµ¬ì¡°ëŠ” ê°’ì´ ì¶”ê°€ í˜¹ì€ ì‚­ì œë  ë–„ë§ˆë‹¤, íŠ¸ë¦¬ ê· í˜•ì„ ìœ„í•´ íŠ¸ë¦¬ êµ¬ì¡°ì˜ ì¬ë¶„ë°° ë° í•©ë³‘ ë“± ë³µì¡í•œ ì—°ì‚°ì´ ìˆ˜í–‰ëœë‹¤.  
    â†’ ë°ì´í„° ê°±ì‹ ë³´ë‹¤ëŠ” ì¡°íšŒì— ì£¼ë¡œ ì‚¬ìš©ë˜ëŠ” ì»¬ëŸ¼ì— Indexë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì´ ìœ ë¦¬í•˜ë‹¤.
    
- Index ëŒ€ìƒ ì»¬ëŸ¼ ì„ ì •
    - ì¼ë°˜ì ìœ¼ë¡œ Cardinalityê°€ ë†’ì€ ì»¬ëŸ¼ì„ ìš°ì„ ì ìœ¼ë¡œ ì¸ë±ì‹±í•˜ëŠ” ê²ƒì´ ê²€ìƒ‰ ì„±ëŠ¥ì— ìœ ë¦¬í•˜ë‹¤.  
    *(Cardinality: íŠ¹ì • ë°ì´í„° ì§‘í•©ì˜ ìœ ë‹ˆí¬(Unique)í•œ ê°’ì˜ ê°œìˆ˜)*
    - Cardinalityê°€ ë†’ì€ ì»¬ëŸ¼ì˜ ê²½ìš°, Indexë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ë” ë§ì´ í•„í„°ë§í•  ìˆ˜ ìˆë‹¤.
    - ì˜ˆì‹œ
        - â€˜ë‚¨-ì—¬â€™ì™€ ê°™ì´ 2ê°€ì§€ ê°’ë§Œ ì¡´ì¬í•˜ëŠ” ì»¬ëŸ¼ì€ ì¤‘ë³µë„ê°€ ë†’ìœ¼ë©° Cardinalityê°€ ë‚®ë‹¤.
        - ê°œì¸ë§ˆë‹¤ ê³ ìœ í•œ ê°’ì´ ì¡´ì¬í•˜ëŠ” ì£¼ë¯¼ë²ˆí˜¸ ì»¬ëŸ¼ì€ ì¤‘ë³µë„ê°€ ë‚®ìœ¼ë©° Cardinalityê°€ ë†’ë‹¤.

> [DB Index ì…ë¬¸](https://tecoble.techcourse.co.kr/post/2021-09-18-db-index/)