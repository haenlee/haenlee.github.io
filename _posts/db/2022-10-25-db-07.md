---
title: "[DB] Deadlock"
excerpt: "" 

categories:
  - DB
tags:
  - [DB]

toc: true
toc_sticky: true
 
date: 2022-10-25
last_modified_at: 2022-10-25
---

# ğŸš€ Deadlock
---
ë‘ê°œ ì´ìƒì˜ íŠ¸ëœì­ì…˜ë“¤ì´ ë™ì‹œì— ì§„í–‰ë ë•Œ ì„œë¡œê°€ ì„œë¡œì— ëŒ€í•œ ë½ì„ ì†Œìœ í•œ ìƒíƒœë¡œ ëŒ€ê¸° ìƒíƒœë¡œ ë¹ ì ¸ì„œ ë”ì´ìƒ ì§„í–‰í•˜ì§€ ëª»í•˜ëŠ” ìƒí™©

- ë°ë“œë½ì€ íŠ¸ëœì­ì…˜ì„ ì§€ì›í•˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì—ì„œëŠ” ìì£¼ ë°œìƒí•˜ëŠ” ë¬¸ì œì´ë‹¤.
- ë©€í‹° ìŠ¤ë ˆë“œ(Multi-threaded) ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë°œìƒí•˜ëŠ” ë°ë“œë½ì€ í•´ë‹¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì™„ì „íˆ ë©ˆì¶”ê²Œ í•´ë²„ë¦¬ê¸° ë•Œë¬¸ì— ìœ„í—˜í•˜ë‹¤.
- í•˜ì§€ë§Œ ì¼ë°˜ì ì¸ DBMS (Database Management System)ì—ì„œëŠ” ë°ë“œë½ íƒì§€(Deadlock detection) ê¸°ëŠ¥ì„ ì œê³µí•˜ê¸°ë•Œë¬¸ì— ë°ë“œë½ì´ ë°œê²¬ë˜ë©´ ìë™ìœ¼ë¡œ í•´ì†Œì‹œì¼œì¤€ë‹¤.  
  (ì‹¤ì œ ë°ë“œë½ ìƒí™©ì´ ì•„ë‹ì§€ë¼ë„ ë½ì— ëŒ€í•œ ëŒ€ê¸°ì‹œê°„ì´ ì„¤ì •ëœ ì‹œê°„ì„ ì´ˆê³¼í•˜ë©´ ì´ê²ƒë„ ë°ë“œë½ìœ¼ë¡œ ì²˜ë¦¬ëœë‹¤)
- ì´ ê³¼ì •ì—ì„œ ì‘ì—…ì¤‘ì´ë˜ íŠ¸ëœì­ì…˜ë“¤ ì¤‘ ì¼ë¶€ê°€ ì·¨ì†Œë˜ëŠ” ê²½ìš°ê°€ ë°œìƒ í•  ìˆ˜ ìˆê¸°ë•Œë¬¸ì— ì–´í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨ì—ì„œ í•´ë‹¹ íŠ¸ëœì­ì…˜ì„ ì¬ì‹¤í–‰ í•˜ì—¬ ì‘ì—…ì„ ì™„ìˆ˜í•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±í•´ì•¼í•œë‹¤.

## ğŸ“ Deadlockì„ ì¤„ì¼ ìˆ˜ ìˆëŠ” ë°©ë²•
- íŠ¸ëœì­ì…˜(transaction)ì„ ìµœëŒ€í•œ ê°„ê²°í•˜ê²Œ ë§Œë“ ë‹¤.
- ì¸ë±ìŠ¤ë¥¼ ì˜ êµ¬ì„±í•´ì•¼í•œë‹¤.  
  ë” ì ê²Œ ë ˆì½”ë“œë¥¼ ìŠ¤ìº”í•  ìˆ˜ë¡ ë” ì ì€ ë½ì´ ê±¸ë¦°ë‹¤.
- Locking read (`SELECT ... FOR UPDATE`,Â `SELECT ... LOCK IN SHARE MODE`)ë¥¼ ì‚¬ìš©ì‹œì— READ_COMMITTEDì™€ ê°™ì€ ë” ë‚®ì€ë ˆë²¨ì˜ íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìƒí™©ì´ë¼ë©´ ì ê·¹ì ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤.
- íŠ¸ëœì­ì…˜ ì•ˆì—ì„œ ì—¬ëŸ¬ ë°ì´í„°ë¥¼ ìˆ˜ì •í• ë•ŒëŠ” ë°œìƒí•˜ëŠ” Lockì˜ ìˆœì„œë¥¼ í•­ìƒ ìˆœì°¨ì ìœ¼ë¡œ ë§Œë“ ë‹¤.
- í•˜ë‚˜ì˜ êµ¬ë¬¸ì— ì—¬ëŸ¬ ROWê°€ í¬í•¨ë˜ëŠ” BatchÂ `INSERT ... ON DUPLICATE KEY UPDATE`ë¥¼ ì£¼ì˜í•˜ë¼.  
  í•˜ë‚˜ì˜ Batch êµ¬ë¬¸ì€ íŠ¸ëœì­ì…˜ì´ ê±¸ë¦° ì—¬ëŸ¬ê°œì˜ êµ¬ë¬¸ ì²˜ëŸ¼ ë™ì‘í•˜ê¸°ë•Œë¬¸ì— ê°ê°ì˜ ë°°ì¹˜ Queryì— í¬í•¨ëœ ë°ì´í„°ì˜ PKê°€ ê²¹ì¹˜ê²Œë˜ë©´ ë°ë“œë½ì´ ë°œìƒí•  í™•ë¥ ì´ ìˆë‹¤.
- íŠ¸ëœì­ì…˜ë“¤ì„ ì™„ì „íˆ Serialize í•œë‹¤.

> [MySQL InnoDB lock & deadlock ì´í•´í•˜ê¸°](https://www.letmecompile.com/mysql-innodb-lock-deadlock/)