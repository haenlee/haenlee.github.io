---
title:  "[Game] 온라인 게임에서 동기화 하는 방법"
excerpt: "물리적으로 멀리 떨어져 있는 플레이어들을 롤백 방식으로 동기화하기" 

categories:
  - Game
tags:
  - [Game, Network]

toc: true
toc_sticky: true
 
date: 2023-11-25
last_modified_at: 2023-11-25
---

# 🚀 게임에서의 딜레이
---
게임 속에서의 행위들은 초당 몇십 프레임의 속도로 이루어진다.
실시간 대전 게임을 예로 들면, 공격시 프레임은 플레이어의 버튼 입력 후 실제 히트까지 걸리는 시간을 나타낸다.
게임에서는 프레임 단위의 신속한 판단이 필요하며 플레이어는 상대의 공격에 대한 프레임을 미리 알고 있다면 게임을 유리하게 진행할 수 있다.

**📢 프레임**   
▪ 1시간 = 60분  
▪ 1분 = 60초  
▪ 1초 = 60프레임  
{: .notice--primary}

<br>
# 🚀 통신 지연 딜레이 기술
---
지구 반대편에 있는 플레이어와 게임을 할 때, 딜레이가 발생한다.  
[https://www.cloudping.info/](https://www.cloudping.info/) 사이트를 통해 얼마나 지연되는지 확인해볼 수 있다.

![image](https://github.com/haenlee/haenlee.github.io/assets/85219306/5b89de13-2601-4583-8306-b4c764aec8ba)

Cape Town을 예로 들면 Latency는 439ms가 걸린다. 이를 프레임으로 환산하면 (60프레임 * 439ms) / 1000ms 이므로 26.34 프레임이 된다.
즉, 버튼 입력 후 26.34 프레임 후 캐릭터가 어떤 동작을 하게 된다는 것을 의미한다.
실시간 대전 게임에서는 4프레임 이상 딜레이되면 게임이 되지 않는다. 26.34 프레임이 걸리는 경우 실시간 대전 게임은 거의 불가능하다고 볼 수 있다.
이러한 딜레이를 해결할 수 있는 방법은 없고, 게임에서는 이를 해결하기 위해 `딜레이 방식`과 `롤백 방식`을 사용한다.

## 📝 딜레이 방식
![image](https://github.com/haenlee/haenlee.github.io/assets/85219306/28a6aff2-dbc9-4842-867b-e17984f24cea)

딜레이 방식은 패킷의 지연을 고려하여 일부러 화면을 지연시키는 방식이다.
일부러 화면을 지연시킴으로써 상대방과 나의 화면에 보이는 동작을 동일하게 표현할 수 있다.
Cape Town에서 26.34 프레임의 딜레이가 발생한다고 했을 때, 나의 화면에서 버튼을 입력하면 26.34 프레임만큼 모션 대기가 발생한 후 공격 모션으로 넘어가게 된다.
하지만 이렇게 됐을 때, 모션 대기로 인해 캐릭터의 동작이 어색하다고 느껴질 수 있다.
이를 해결하기 위해 `롤백 방식`의 동기 방식이 나타났다.

<br>
# 🚀 롤백 방식
---
![image](https://github.com/haenlee/haenlee.github.io/assets/85219306/86392d07-cb97-4ce6-9dd3-c9b8a85cbab1)

롤백 방식은 플레이어의 입력 전 상태를 예측하여 딜레이를 최소화한다. 
버튼 입력 후 입력 도달까지의 사이에서 상대의 화면에는 미래 예측이 표시되고, 만약 예측이 벗어난 경우에는 수정(롤백)된다. 
이러한 방식으로 지연을 최소화하고 자연스러운 게임 플레이를 제공한다.

![image](https://github.com/haenlee/haenlee.github.io/assets/85219306/236475c0-f2d3-44ed-8a7c-e322cb11b783)

위와 같이 미래 예측이 벗어난 경우에서는 통신 품질이 나쁜 경우, 캐릭터가 워프한 것처럼 보일 수 있다.
하지만 실시간 대전 게임에서는 어느 정도의 딜레이보다 지연됐을 때 에러를 발생시켜 세션을 끊는 방법을 사용한다.

## 📝 MIT 라이선스 및 활용
롤백 방식은 2019년 10월 MIT 라이선스로 오픈 소스로 제공되고, 현재는 많은 온라인 게임에서 사용되고 있다. 
이 기술은 전세계적으로 게임 플레이어 간의 통신 지연 문제를 해결하고, 업계 표준으로 자리잡고 있다.

> [GGPO](https://github.com/pond3r/ggpo)

<br>
# 🚀 결론
---
실시간 대전 게임에서는 높은 반사 신경과 상황 판단이 요구되며, 통신 지연 문제는 롤백 방식을 통해 혁신적으로 해결되고 있다. 
이러한 기술의 활용은 온라인 게임의 성공적인 운영을 가능하게 하고, 플레이어들에게 원활하고 현실적인 게임 경험을 제공한다.

> [온라인 게임에서는 서로의 위치가 멀리 떨어져 있어도 왜 빠르게 동기화할 수 있을까? 어떻게 통신하고 있을까?](https://jacking75.github.io/network_1005/)