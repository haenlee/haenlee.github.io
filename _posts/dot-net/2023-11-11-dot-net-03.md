---
title: "[.NET] Threadë¡œë¶€í„° ì•ˆì „í•œ ì»¬ë ‰ì…˜"
excerpt: "lockê³¼ ë¹„êµí•´ë³´ê¸°" 

categories:
  - .NET
tags:
  - [.NET]

toc: true
toc_sticky: true
 
date: 2023-11-11
last_modified_at: 2023-11-11
---

.NET Framework 4ì—ì„œëŠ” ë©€í‹° ìŠ¤ë ˆë“œì˜ ì•ˆì •ì„±ì„ ë‹¬ì„±í•˜ê¸° ìœ„í•´ ë””ìì¸ëœ 5ê°€ì§€ ì»¬ë ‰ì…˜ í˜•ì‹ì´ ë„ì…ëë‹¤.
ì´ ì»¬ë ‰ì…˜ë“¤ì€ lockê³¼ lock í•´ì œ ë™ê¸°í™”ë¥¼ ìœ„í•´ íš¨ìœ¨ì ì¸ ë§¤ì»¤ë‹ˆì¦˜ì„ ì‚¬ìš©í•˜ê³  ìˆì§€ë§Œ, ë™ê¸°í™”ë¡œ ì¸í•œ ì˜¤ë²„í—¤ë“œ ë¬¸ì œê°€ ìˆë‹¤.
í•˜ì§€ë§Œ ìŠ¤ë ˆë“œê°€ ìš”ì†Œë¥¼ ì¶”ê°€/ì œê±° í•˜ëŠ” ì‘ì—…ë§Œì„ í•  ê²½ìš° ìŠ¤ë ˆë“œë¡œë¶€í„° ì•ˆì „í•˜ì§€ ì•Šì€ í˜•ì‹ë³´ë‹¤ í›¨ì”¬ ë” ë¹ ë¥´ê²Œ ìˆ˜í–‰í•˜ê³  ì˜¤ë²„í—¤ë“œ ë˜í•œ ê±°ì˜ ì—†ë‹¤.
Concurrent ì»¬ë ‰ì…˜ì€ .NET Framework 4ì—ì„œ ë„ì…ëœ SpinLock, SpinWait, SemaphoreSlim ë° CountdownEventì™€ ê°™ì€ ë™ê¸°í™” ë§¤ì»¤ë‹ˆì¦˜ì„ ì‚¬ìš©í•œë‹¤.

# ğŸš€ Concurrent ì»¬ë ‰ì…˜
---
## ğŸ“ ConcurrentQueue<T>
ìŠ¤ë ˆë“œë¡œë¶€í„° ì•ˆì „í•œ `FIFO` ì»¬ë ‰ì…˜ì´ë‹¤. ì—¬ëŸ¬ ìŠ¤ë ˆë“œì—ì„œ ë™ì‹œì— ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” Enqueue ë° TryDequeueì™€ ê°™ì€ ë©”ì„œë“œë¥¼ ì œê³µí•œë‹¤.

```c#
ConcurrentQueue<int> concurrentQueue = new ConcurrentQueue<int>();
concurrentQueue.Enqueue(1);
int result;
if (concurrentQueue.TryDequeue(out result))
{
    // Process the dequeued item
}
```

## ğŸ“ ConcurrentStack<T>
ìŠ¤ë ˆë“œë¡œë¶€í„° ì•ˆì „í•œ `LIFO` ì»¬ë ‰ì…˜ì´ë‹¤. ì•ˆì „í•œ ë™ì‹œ ì•¡ì„¸ìŠ¤ë¥¼ ìœ„í•´ Push ë° TryPopê³¼ ê°™ì€ ë©”ì„œë“œë¥¼ ì œê³µí•œë‹¤.

```c#
ConcurrentStack<int> concurrentStack = new ConcurrentStack<int>();
concurrentStack.Push(1);
int result;
if (concurrentStack.TryPop(out result))
{
    // Process the popped item
}
```

## ğŸ“ ConcurrentBag<T>
ìŠ¤ë ˆë“œë¡œë¶€í„° ì•ˆì „í•˜ê³  `ìˆœì„œê°€ ì§€ì •ë˜ì§€ ì•Šì€ Element` ì»¬ë ‰ì…˜ì´ë‹¤. Elementì˜ ìˆœì„œê°€ ì¤‘ìš”í•˜ì§€ ì•Šì€ ì‹œë‚˜ë¦¬ì˜¤ì— íš¨ìœ¨ì ìœ¼ë¡œ ì„¤ê³„ë˜ì—ˆë‹¤.

```c#
ConcurrentBag<int> concurrentBag = new ConcurrentBag<int>();
concurrentBag.Add(1);
```

## ğŸ“ ConcurrentDictionary<TKey, TValue>
ìŠ¤ë ˆë“œë¡œë¶€í„° ì•ˆì „í•œ `Key/Value pair` ì»¬ë ‰ì…˜ì´ë‹¤. ì•ˆì „í•œ ë™ì‹œ ì•¡ì„¸ìŠ¤ë¥¼ ìœ„í•´ TryAdd, TryUpdate ë° TryRemoveì™€ ê°™ì€ ë©”ì„œë“œë¥¼ ì œê³µí•œë‹¤.

```c#
ConcurrentDictionary<string, int> concurrentDictionary = new ConcurrentDictionary<string, int>();
concurrentDictionary.TryAdd("key", 1);
```

## ğŸ“ BlockingCollection<T>
`ë°”ìš´ë”© ë° ë¸”ë¡œí‚¹ ê¸°ëŠ¥`ì´ ìˆëŠ” ìŠ¤ë ˆë“œ ì•ˆì „ ì»¬ë ‰ì…˜ì´ë‹¤. ìƒì‚°ì-ì†Œë¹„ì ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ ìì£¼ ì‚¬ìš©ë˜ê³  ìµœëŒ€ ìš©ëŸ‰ì„ ì§€ì •í•  ìˆ˜ ìˆìœ¼ë©°, ìš©ëŸ‰ì— ë„ë‹¬í•˜ë©´ ê³µê°„ì´ í™•ë³´ë  ë•Œê¹Œì§€ í•­ëª© ì¶”ê°€ ì‹œë„ê°€ ì°¨ë‹¨ëœë‹¤.

```c#
BlockingCollection<int> blockingCollection = new BlockingCollection<int>(boundedCapacity: 10);
blockingCollection.Add(1); // Blocks if the collection is full
```

<br>
# ğŸš€ Concurrent ì»¬ë ‰ì…˜ê³¼ Lock ë¹„êµí•˜ê¸°
---
ë©€í‹° ìŠ¤ë ˆë“œì—ì„œëŠ” ìŠ¤ë ˆë“œë¡œë¶€í„° ì•ˆì „í•œ ì»¬ë ‰ì…˜ì„ ì‚¬ìš©í•œë‹¤ê³  í•´ì„œ ëª¨ë“  ë©€í‹° ìŠ¤ë ˆë“œ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤.
ì¼ë°˜ì ìœ¼ë¡œ ì»¬ë ‰ì…˜ì´ ìŠ¤ë ˆë“œë¡œë¶€í„° ì•ˆì „í•˜ë‹¤ëŠ” ì˜ë¯¸ëŠ” ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— read/writeë¥¼ í•´ë„ ë‚´ë¶€ì ìœ¼ë¡œ ì¼ê´€ëœ ìƒíƒœë¥¼ ìœ ì§€í•œë‹¤ëŠ” ê²ƒì„ ë§í•œë‹¤.
ë¬¼ë¡ , Concurrent ì»¬ë ‰ì…˜ì€ ë‚´ë¶€ì ìœ¼ë¡œ ì¼ê´€ëœ ìƒíƒœë¥¼ ìœ ì§€í•˜ê¸° ë•Œë¬¸ì— ìŠ¤ë ˆë“œë¡œë¶€í„° ì•ˆì „í•˜ë‹¤.
í•˜ì§€ë§Œ Conncurrent ì»¬ë ‰ì…˜ì—ì„œ ì œê³µí•˜ëŠ” ëª‡ëª‡ ê¸°ëŠ¥ë“¤ì€ ìŠ¤ë ˆë“œë¡œë¶€í„° ì•ˆì „í•˜ë‹¤ê³  ë§í•  ìˆ˜ ì—†ë‹¤.
ì˜ˆë¥¼ë“¤ì–´ `ConcurrentDictionaryì˜ Keysì™€ Values ì†ì„±ì€ í•´ë‹¹ ì»¬ë ‰ì…˜ì˜ 'ìŠ¤ëƒ…ìƒ·'ì´ë©° ì‹¤ì œ Dictionaryì˜ ìƒíƒœì™€ ì¼ì¹˜í•˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤.`
ì´ ê²½ìš° ì‹¤ì œ Dictionaryì˜ ìƒíƒœì™€ ë¹„êµí•˜ê²Œ ëœë‹¤ë©´ ìƒê°í•˜ì§€ ëª»í•œ ì˜ˆì™¸ê°€ ìƒê¸¸ìˆ˜ë„ ìˆìœ¼ë©° ì¶”ê°€ì ì¸ ì˜ˆì™¸ì²˜ë¦¬ê°€ í•„ìš”í•˜ë‹¤.
ì¦‰, Conccurent ì»¬ë ‰ì…˜ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒë³´ë‹¤ ìˆ˜ë™ìœ¼ë¡œ Lockì„ ê±¸ì–´ì£¼ëŠ” ê²ƒì´ ë” íš¨ìœ¨ì ì¼ ìˆ˜ë„ ìˆë‹¤.

>[ìŠ¤ë ˆë“œë¡œë¶€í„° ì•ˆì „í•œ ì»¬ë ‰ì…˜](https://learn.microsoft.com/ko-kr/dotnet/standard/collections/thread-safe/)  
>[ìŠ¤ë ˆë“œë¡œë¶€í„° ì•ˆì „í•œ ì»¬ë ‰ì…˜ ì‚¬ìš© ì‹œê¸°](https://learn.microsoft.com/ko-kr/dotnet/standard/collections/thread-safe/when-to-use-a-thread-safe-collection)