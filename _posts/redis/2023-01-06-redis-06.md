---
title: "[Redis] Pythonìœ¼ë¡œ ê²Œì‹œíŒ ë§Œë“¤ê¸°"
excerpt: "ì‘ì„±ì, ê²Œì‹œê¸€ì„ ì €ì¥í•˜ê³  ì¶œë ¥í•˜ëŠ” ê°„ë‹¨í•œ í”„ë¡œì íŠ¸ ë§Œë“¤ê¸°"

categories:
  -  Redis
tags:
  - [BackEnd, DB, Redis, Python]

toc: true
toc_sticky: true
 
date: 2023-01-06
last_modified_at: 2023-01-06
---

# ğŸš€ í”„ë¡œì íŠ¸ ìƒì„±í•˜ê¸°
---

## ğŸ“ Redis ì´ˆê¸°í™”
ì´ì „ì— ì‹¤ìŠµí•œ ë‚´ìš©ë“¤ì´ ë‚¨ì•„ìˆì–´ Redisë¥¼ ì´ˆê¸°í™”í•´ì¤„ í•„ìš”ì„±ì´ ìƒê²¼ë‹¤. ìœ„ ëª…ë ¹ì–´ë¥¼ í†µí•´ í˜„ì¬ ì‚¬ìš©ì¤‘ì¸ DBì˜ ëª¨ë“  ë°ì´í„°ë“¤ì„ ì‚­ì œí•  ìˆ˜ ìˆë‹¤.
```
flushdb [ASYNC]
```

Redis ë²„ì „ 6.2ë¶€í„° ASYNC ì˜µì…˜ì´ ì¶”ê°€ë˜ì—ˆëŠ”ë°, ì˜µì…˜ì„ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ ë””í´íŠ¸ëŠ” SYNCë¡œ ì‘ë™í•œë‹¤. 
ASYNC ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ ë³„ë„ì˜ ìŠ¤ë ˆë“œì—ì„œ backgroundë¡œ ë°ì´í„°ë“¤ì„ ì‚­ì œí•˜ê¸° ë•Œë¬¸ì— ì‘ë‹µ ì†ë„ê°€ ë§¤ìš° ë¹ ë¥´ë‹¤.

![image](https://user-images.githubusercontent.com/85219306/211010438-7f435b3f-0fe9-4edd-ab05-5dd201c19293.png)

## ğŸ“ í”„ë¡œì íŠ¸ ìƒì„±
ê²Œì‹œíŒì„ ë§Œë“¤ê¸° ìœ„í•´ ë¨¼ì € Python í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•´ì•¼ í•œë‹¤.
Postë¼ëŠ” ì´ë¦„ìœ¼ë¡œ í´ë”ë¥¼ ìƒì„±í•˜ê³  **main.py** íŒŒì¼ì„ ìƒì„±í•˜ì˜€ë‹¤. 
main.py íŒŒì¼ì—ì„œëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•  ë•Œ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì—ì„œ ë¯¸ë¦¬ ì¤€ë¹„í•´ë†“ì€ htmlì„ ë³´ì—¬ì£¼ë„ë¡ í•œë‹¤.

```python
import redis

from flask import Flask, render_template

app = Flask(__name__)

@app.route("/")
def home():
    return render_template("home.html")

if __name__ == "__main__":
    app.run()
```

![image](https://user-images.githubusercontent.com/85219306/211011155-d9045633-e24c-4d9a-9631-6a06041c0ff3.png)

<br>
# ğŸš€ ê²Œì‹œê¸€ ì˜¬ë¦¬ê¸°
---
## ğŸ“ POST
ê²Œì‹œê¸€ì„ ì˜¬ë¦¬ê³  ê²Œì‹œê¸€ì„ í™•ì¸í•˜ê¸° ìœ„í•´ GET, POST ìš”ì²­ì„ ì‘ì„±í•œë‹¤.  
ë¯¸ë¦¬ ì‘ì„±í•´ë‘” **home.html**ì„ ë³´ë©´ POST ìš”ì²­ì„ ë³´ë‚¼ ë•Œ full_nameê³¼ dataë¡œ ë°ì´í„°ë¥¼ ë³´ë‚´ê³  ìˆëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

![image](https://user-images.githubusercontent.com/85219306/211020124-bf1387bd-e900-42c9-a364-295141ed8d6f.png)

```python
from flask import Flask, render_template, request, flash

app = Flask(__name__)
app.secret_key = 'super secret key'

r = redis.Redis('127.0.0.1')

last_id = 0

@app.route("/", methods=["GET", "POST"])
def home():
    if request.method == "POST":
        global last_id
        req = request.form
        name = req["full_name"]
        post = req["data"]
        print(name, post)

    return render_template("home.html")

if __name__ == "__main__":
    app.run()
```

## ğŸ“ ì „ì²´ì ì¸ Flow
![image](https://user-images.githubusercontent.com/85219306/211021774-4456aad7-30c9-476c-93cb-e0eaaca90ec0.png)

ì „ì²´ì ì¸ ê²Œì‹œê¸€ ì €ì¥ ê³¼ì •ì„ ì‚´í´ë³´ë©´, ë¨¼ì € Formì„ í†µí•´ Post ìš”ì²­ì´ ë“¤ì–´ì˜¨ë‹¤. 
Post ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ nameê³¼ dataë¥¼ Redisì— ì €ì¥í•œë‹¤.  

1) news:name:{last_id}: ê²Œì‹œê¸€ idì— ë”°ë¥¸ ì‘ì„±ìë¥¼ ì €ì¥í•œë‹¤.  
2) news:post:{last_id}: ê²Œì‹œê¸€ idì— ë”°ë¥¸ ê²Œì‹œê¸€ì„ ì €ì¥í•œë‹¤.  
3) last_id: ê°€ì¥ ìµœì‹  ê²Œì‹œê¸€ì˜ idë¥¼ ì €ì¥í•œë‹¤.  
4) Post_id: List íƒ€ì…ìœ¼ë¡œ ê²Œì‹œê¸€ì˜ idë¥¼ ì €ì¥í•œë‹¤.  

**set** ëª…ë ¹ì–´ë¥¼ í†µí•´ ê°ê°ì˜ key-valueë¥¼ ì €ì¥í•œë‹¤. last_idë¥¼ +1í•˜ë©´ì„œ ìœ íš¨í•œ indexë¥¼ ê°€ì§ˆ ìˆ˜ ìˆë„ë¡ í•˜ì˜€ë‹¤.  
ì €ì¥ì´ ì™„ë£Œ ë˜ë©´ Frontì—ì„œëŠ” 'Successfully submitted the post' ë©”ì‹œì§€ë¥¼ ë³´ì—¬ì¤€ë‹¤.

```python
from email.mime import application
import redis

from flask import Flask, render_template, request, flash

app = Flask(__name__)
app.secret_key = 'super secret key'

r = redis.Redis('127.0.0.1')

last_id = 0

@app.route("/", methods=["GET", "POST"])
def home():
    if request.method == "POST":
        global last_id
        req = request.form
        name = req["full_name"]
        post = req["data"]
        print(name, post)
        
        last = r.get("last_id")
        if last is None:
            last_id = 1
        else:
            last_id = int(last)
            last_id += 1

        r.set(f"news:name:{last_id}", name)
        r.set(f"news:post:{last_id}", post)
        r.set("last_id", last_id)
        r.lpush("post_id", last_id)
        flash("Successfully submitted the post", category='success')

    return render_template("home.html")

if __name__ == "__main__":
    app.run()
```

![image](https://user-images.githubusercontent.com/85219306/211022727-9dc34561-b719-4387-ab05-a27481c39a55.png)

## ğŸ“ Redis í™•ì¸í•´ë³´ê¸°
'john, hello', 'bob, bye' ë¼ëŠ” ê²Œì‹œê¸€ì„ ì‘ì„±í•˜ê³  Redisì— ì œëŒ€ë¡œ ì €ì¥ë˜ì–´ìˆëŠ”ì§€ í™•ì¸í•´ë³´ì•˜ë‹¤.

![image](https://user-images.githubusercontent.com/85219306/211023071-60046e8c-a557-49be-83ab-29b40b3b16ed.png)

<br>
# ğŸš€ ëª¨ë“  ê²Œì‹œê¸€ ë³´ê¸°
---
Redisì— key-valueë¡œ ë°ì´í„°ê°€ ì €ì¥ë˜ì–´ ìˆëŠ” ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ ë³´ì—¬ì£¼ë ¤ê³  í•œë‹¤.

1) List íƒ€ì…ìœ¼ë¡œ ì €ì¥í•´ë‘” idë“¤ì„ ê°€ì ¸ì˜¨ë‹¤.  
2) forë¬¸ìœ¼ë¡œ idì— í•´ë‹¹í•˜ëŠ” ê²Œì‹œê¸€ì„ ê°€ì ¸ì˜¨ë‹¤.  

ê°„ë‹¨í•˜ê²Œ ë‘ê°€ì§€ ê³¼ì •ì„ í•˜ë©´ ë˜ëŠ”ë° ì¤‘ìš”í•œ ê²ƒì€ `Redisì—ì„œì˜ getì€ byte íƒ€ì…ìœ¼ë¡œ ë¦¬í„´`ëœë‹¤ëŠ” ê²ƒì´ë‹¤. 
ë”°ë¼ì„œ, byte íƒ€ì…ì„ ë¬¸ìì—´ë¡œ ë””ì½”ë”© í•˜ëŠ” ê³¼ì •ì´ í•„ìš”í•˜ë‹¤.

ì‘ì„±ìì™€ ê²Œì‹œê¸€ì„ ë§¤í•‘í•˜ëŠ” ë°ì´í„° íƒ€ì…ìœ¼ë¡œ dictionaryë¥¼ ì‚¬ìš©í–ˆë‹¤. idë¥¼ utf-8ë¡œ ë””ì½”ë”©í•œ í•˜ê³  ë””ì½”ë”©í•œ idë¡œ ê°ê°ì˜ ì‘ì„±ìì™€ ê²Œì‹œê¸€ì„ ê°€ì ¸ì˜¨ë‹¤.
getí•´ì˜¨ ì‘ì„±ìì™€ ê²Œì‹œê¸€ì„ ë‹¤ì‹œ utf-8ë¡œ ë””ì½”ë”©í•˜ëŠ” ê³¼ì •ì„ ê±°ì¹œ í›„ dictinaryì— ë„£ê³ , forë¬¸ì´ ëë‚˜ë©´ dictionaryë¥¼ ë‚´ë ¤ì¤€ë‹¤.

```python
@app.route("/all")
def all_post():
    post_ids = r.lrange("post_id", 0, -1)
    posts = dict()

    for post_id in post_ids:
        name_byte = r.get(f'news:name:{post_id.decode("utf-8")}')
        name = name_byte.decode("utf-8")

        post_byte = r.get(f'news:post:{post_id.decode("utf-8")}')
        post_data = post_byte.decode("utf-8")

        posts[name] = post_data
    
    return render_template("all.html", posts = posts)
```

![image](https://user-images.githubusercontent.com/85219306/211028066-a320c350-b74f-41c7-83a3-f9ab02f592b3.png)

<br>
# ğŸš€ ìµœê·¼ ê²Œì‹œê¸€ ë³´ê¸°
---
Redisì— key-valueë¡œ ë°ì´í„°ê°€ ì €ì¥ë˜ì–´ ìˆëŠ” ìµœì‹  3ê°œì˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ ë³´ì—¬ì£¼ë ¤ê³  í•œë‹¤.
ëª¨ë“  ê²Œì‹œê¸€ ë³´ê¸°ì™€ ê±°ì˜ ë™ì¼í•˜ë‹¤. 
ë‹¤ë¥¸ì ì€ ì „ì²´ ë°ì´í„°ê°€ ì•„ë‹Œ 3ê°œì˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ **r.lrange("post_id", 0, -1)** ì—ì„œ **r.lrange("post_id", 0, 2)**ë¡œ 0ì—ì„œ 2ê¹Œì§€ì˜ ì¸ë±ìŠ¤ë¥¼ ê°€ì ¸ì˜¨ë‹¤.

```python
@app.route("/latest")
def latest_post():
    post_ids = r.lrange("post_id", 0, 2)
    posts = dict()

    for post_id in post_ids:
        name_byte = r.get(f'news:name:{post_id.decode("utf-8")}')
        name = name_byte.decode("utf-8")

        post_byte = r.get(f'news:post:{post_id.decode("utf-8")}')
        post_data = post_byte.decode("utf-8")

        posts[name] = post_data
    
    return render_template("latest.html", posts = posts)
```

![image](https://user-images.githubusercontent.com/85219306/211031608-c4d97768-3e70-4f35-aed5-232e26ab917b.png)

![image](https://user-images.githubusercontent.com/85219306/211031466-2dcc6770-dc74-40d8-8594-faaf48d810a4.png)

<br>
# ğŸš€ ì „ì²´ ì½”ë“œ
---
```python
from email.mime import application
import redis

from flask import Flask, render_template, request, flash

app = Flask(__name__)
app.secret_key = 'super secret key'

r = redis.Redis('127.0.0.1')

last_id = 0

@app.route("/", methods=["GET", "POST"])
def home():
    if request.method == "POST":
        global last_id
        req = request.form
        name = req["full_name"]
        post = req["data"]
        print(name, post)
        
        last = r.get("last_id")
        if last is None:
            last_id = 1
        else:
            last_id = int(last)
            last_id += 1

        r.set(f"news:name:{last_id}", name)
        r.set(f"news:post:{last_id}", post)
        r.set("last_id", last_id)
        r.lpush("post_id", last_id)
        flash("Successfully submitted the post", category='success')

    return render_template("home.html")

@app.route("/all")
def all_post():
    post_ids = r.lrange("post_id", 0, -1)
    posts = dict()

    for post_id in post_ids:
        name_byte = r.get(f'news:name:{post_id.decode("utf-8")}')
        name = name_byte.decode("utf-8")

        post_byte = r.get(f'news:post:{post_id.decode("utf-8")}')
        post_data = post_byte.decode("utf-8")

        posts[name] = post_data
    
    return render_template("all.html", posts = posts)

@app.route("/latest")
def latest_post():
    post_ids = r.lrange("post_id", 0, 2)
    posts = dict()

    for post_id in post_ids:
        name_byte = r.get(f'news:name:{post_id.decode("utf-8")}')
        name = name_byte.decode("utf-8")

        post_byte = r.get(f'news:post:{post_id.decode("utf-8")}')
        post_data = post_byte.decode("utf-8")

        posts[name] = post_data
    
    return render_template("latest.html", posts = posts)

if __name__ == "__main__":
    app.run()
```