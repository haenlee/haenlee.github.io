---
title:  "[TDD] 단위 테스트(Unity Test) 작성의 필요성"
excerpt: ""

categories:
  - Java
tags:
  - [Java, TDD, Unit Test]

toc: true
toc_sticky: true
 
date: 2022-03-17
last_modified_at: 2022-03-17
---

## 1️⃣ 단위 테스트 vs 통합 테스트 차이
### 단위 테스트(Unit Test)
단위 테스트(Unit Test)는 <strong>하나의 모듈을 기준으로 독립적으로 진행되는 가장 작은 단위의 테스트</strong>이다.
여기서 모듈은 애플리케이션에서 작동하는 하나의 기능 또는 메소드로 이해할 수 있다.
예를 들어 웹 애플리케이션에서 로그인 메소드에 대한 독립적인 테스트가 1개의 단위 테스트가 될 수 있다.

### 통합 테스트(Intergration Test)
통합 테스트(Intergration Test)는 <strong>모듈을 통합하는 과정에서 모듈 간의 호환성을 확인하기 위해 수행되는 테스트</strong>이다.
일반적으로 애플리케이션은 여러개의 모듈들로 구성이 되고, 모듈들끼리 메시지를 주고 받으면서(함수 호출) 기능을 수행한다.
그렇기에 통합된 모듈들이 올바르게 연계되어 동작하는지 검증이 필요한데, 이러한 목적으로 진행되는 테스트가 통합 테스트이다.
그렇기에 통합 테스트는 독립적인 기능에 대한 테스트가 아니라 웹 페이지로부터 API를 호출하여 올바르게 동작하는 지를 확인하는 것이다.

## 2️⃣ 단위 테스트(Unit Test) 작성의 필요성
일반적으로 실무에서 테스트 코드를 작성한다고 하면 거의 단위 테스트를 의미한다.
통합 테스트는 실제 여러 컴포넌트들 간의 상호작용을 테스트하기 때문에 모든 컴포넌트들이 구동된 상태에서 테스트를 하게 된다.
그렇기에 통합 테스트를 위해서는 캐시나 데이터베이스등 다른 컴포넌트들과 실제 연결을 해야 하고, 시스템을 구성하는 컴포넌트들이 많아질수록 테스트를 위한 비용(시간)이 상당히 커진다.
반면에 단위 테스트는 해당 부분만 독립적으로 테스트하기 때문에 어떤 코드를 리팩토링하여도 빠르게 문제 여부를 확인할 수 있다.

- 테스팅에 대한 시간과 비용을 절감할 수 있다.
- 새로운 기능 추가 시에 수시로 빠르게 테스트 할 수 있다.
- 리팩토링 시에 안정성을 확보할 수 있다.
- 코트에 대한 문서가 될 수 있다.

그렇기 때문에 실무에서는 단위 테스트를 선호하며, 요즘 많이 사용되는 TDD(Test-Driven Development, 테스트 주도 개발)에서 얘기하는 테스트도 단위 테스트를 의미한다.
우리는 우리가 작성한 테스트 코드를 수시로 빠르게 돌리면서 문제를 파악할 수 있다.

### 단위 테스트의 문제점과 Stub
어떤 객체가 자체적으로 모든 일을 처리한다면 문제가 없겠지만, 일반적인 애플리케이션에서는 1개의 기능을 처리하기 위해 다른 객체들과 메세지를 주고 받아야 한다. 
하지만 앞서 설명하였듯 단위 테스트는 해당 모듈에 대한 독립적인 테스트이기 때문에 다른 객체와 메세지를 주고 받는 경우에 문제가 발생한다. 
그렇기 때문에 다른 객체 대신에 가짜 객체(Mock Object)를 주입하여 어떤 결과를 반환하라고 정해진 답변을 준비시켜야 하는데, 이를 stub이라고 한다.
예를 들어 데이터베이스에 새로운 데이터를 추가하는 코드를 테스트한다고 하면, 가짜 데이터베이스(Mock Database)를 주입하여 insert 처리 시에 반드시에 1을 반환하도록 해주는 것이 stub이다.

### 좋은 단위 테스트의 특징
일반적으로 요구 사항은 계속해서 변하고, 그에 맞춰 우리의 코드 역시 변경되어야 한다. 하
지만 실제 코드를 변경한다는 것은 잠재적인 버그가 발생할 수 있음을 내포하는데, 좋은 테스트 코드가 있다면 변경된 코드를 검증함으로써 이를 해결할 수 있다. 
또한 실제 코드가 변경되면 테스트 코드 역시 변경이 필요할 수 있는데, 이러한 이유로 우리는 테스트 코드 역시 가독성있게 작성할 필요가 있다.

그렇기에 테스트를 작성하는 경우에는 다음을 준수하는 것이 좋다.

1. 1개의 테스트 함수에 대해 assert를 최소화하라
2. 1개의 테스트 함수는 1가지 개념 만을 테스트하라
<br>
<br>

또한 좋고 깨끗한 테스트 코드는 FIRST라는 5가지 규칙을 따라야 한다.

1. Fast
  : 테스트는 빠르게 동작하여 자주 돌릴 수 있어야 한다.
2. Independent
  : 각각의 테스트는 독립적이며 서로 의존해서는 안된다.
3. Repeatable
  : 어느 환경에서도 반복 가능해야 한다.
4. Self-Validating 
  : 테스트는 성공 또는 실패로 bool 값으로 결과를 내어 자체적으로 검증되어야 한다.
5. Timely
  : 테스트는 적시에 즉, 테스트하려는 실제 코드를 구현하기 직전에 구현해야 한다.


## 3️⃣ Java 단위 테스트(Unit Test) 작성 준비
### 필요한 라이브러리
요즘 Java 단위테스트 작성에는 크게 2가지 라이브러리가 사용된다.

- JUnit5: 자바 단위 테스트를 위한 테스팅 프레임워크
- AssertJ: 자바 테스트를 돕기 위해 다양한 문법을 지원하는 라이브러리

JUnit 만으로도 단위 테스트를 충분히 작성할 수 있다. 
하지만 JUnit에서 제공하는 assertEquals()와 같은 메소드는 AssertJ가 주는 메소드에 비해 가독성이 떨어진다. 
그렇기 때문에 순수 Java 애플리케이션에서 단위 테스트를 위해 JUnit5와 AssertJ 조합이 많이 사용된다.

### given/when/then 패턴
요즘 단위테스트는 거의 given-when-then 패턴으로 작성하는 추세이다. 
given-when-then 패턴이란 1개의 단위 테스트를 3가지 단계로 나누어 처리하는 패턴으로, 각각의 단계는 다음을 의미한다.

- given(준비): 어떠한 데이터가 준비되었을 때
- when(실행): 어떠한 함수를 실행하면
- then(검증): 어떠한 결과가 나와야 한다.

추가적으로 어떤 메소드가 몇번 호출되었는지를 검사하기 위한 verify 단계도 사용하는 경우가 있는데, 그렇게 실용성이 크지 않으므로 메소드의 호출 횟수가 중요한 테스트에서만 선택적으로 사용하면 될 것 같다.

### 테스트 코드 작성 공통 규칙
```java
@DisplayName("테스트") 
@Test 
void Test() {    
  // given

  // when 

  // then 

  }
```
`@Test`는 해당 메소드가 단위 테스트임을 명시하는 어노테이션이다. 
JUnit은 테스트 패키지 하위의 @Test 어노테이션이 붙은 메소드를 단위 테스트로 인식하여 실행시킨다.<br>
이 상태로 실행하면 테스트 이름이 함수 이름이 default로 지정되는데, 우리는 `@DisplayName` 어노테이션을 사용하여 읽기 좋은 다른 이름을 부여할 수 있다.<br>
또한 테스트 코드는 앞서 설명한 given-when-then 구조로 흔히 작성되는데, 단위 테스트 내에 주석으로 이 단계를 명시해주면 읽기 좋은 테스트 코드를 작성할 수 있다. 
(IntelliJ를 사용중이라면 live template를 직접 설정해 빠르게 작성할 수 있다.)

